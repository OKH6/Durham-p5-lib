const WebbedTextColorType={FIXED:0,RANDOM_FIXED:1,RANDOM_DYNAMIC:2,DELTA_SMOOTHED:4,TWINKLE:8};class Time{constructor(){this.currentTime=millis()}getDelta(){return this.oldTime=this.currentTime,this.currentTime=millis(),this.currentTime-this.oldTime}}class WebbyChars{constructor(t,e=1e3,i=1e3,s=null,o=null){this.webbedTexts=[],!1===t&&(this.canvas=createCanvas(e,i),"string"==typeof s&&this.canvas.parent(s)),this.background=o}add(t){t.setup(),this.webbedTexts.push(t)}remove(t){for(let e=0;e<this.webbedTexts.length;e++)this.webbedTexts[e]===t&&this.webbedTexts.splice(e,1)}getCanvas(){return this.canvas}getWebbedTexts(){return this.webbedTexts}draw(t=null){null!==this.background&&(null!==t?g.background(this.background):background(this.background));for(let e=0;e<this.webbedTexts.length;e++)this.webbedTexts[e].draw(t)}}class WebbedTextColor{constructor(t,e=null,i=null,s=1e3){this.flags=t,this.c1=e,this.c2=i,this.currentColor=null,this.maxTime=s,this.timeLeft=s,this.targetColor=null,this.time=new Time}clone(){let t=new WebbedTextColor(this.flags,this.c1,this.c2,this.maxTime);return t.currentColor=this.currentColor,t.timeLeft=this.timeLeft,t.targetColor=this.targetColor,t.time=new Time,t}getColor(){let t=this.time.getDelta();return this.hasFlag(WebbedTextColorType.RANDOM_FIXED)?null===this.currentColor&&(this.currentColor=this.getRandomColor(this.c1,this.c2)):this.hasFlag(WebbedTextColorType.RANDOM_DYNAMIC)?this.hasFlag(WebbedTextColorType.DELTA_SMOOTHED)?(this.setDeltaDefaults(),this.updateDeltaColor(t,this.getRandomColor(this.c1,this.c2))):this.currentColor=this.getRandomColor(this.c1,this.c2):this.hasFlag(WebbedTextColorType.TWINKLE)?this.hasFlag(WebbedTextColorType.DELTA_SMOOTHED)?(this.setDeltaDefaults(),this.currentColor===this.c1?this.updateDeltaColor(t,this.c2):this.currentColor===this.c2?this.updateDeltaColor(t,this.c1):this.targetColor===this.c1?this.updateDeltaColor(t,this.c2):this.targetColor===this.c2&&this.updateDeltaColor(t,this.c1)):this.currentColor===this.c1?this.currentColor=this.c2:this.currentColor=this.c1:null===this.c1?this.currentColor=color(255,255,255,128):this.currentColor=this.c1,this.currentColor}hasFlag(t){return(this.flags&t)===t}updateDeltaColor(t,e){this.timeLeft<=t?(this.currentColor=this.targetColor,this.targetColor=e,this.timeLeft=this.maxTime):(this.currentColor=lerpColor(this.currentColor,this.targetColor,t/this.timeLeft),this.timeLeft-=t)}setDeltaDefaults(){null===this.currentColor&&(null===this.c1?this.currentColor=color(255,255,255,255):this.currentColor=this.c1),null===this.targetColor&&(null===this.c2?this.targetColor=color(255,255,255,255):this.targetColor=this.c2)}getRandomColor(t,e){let i={r:0,g:0,b:0,a:255},s={r:255,g:255,b:255,a:255};return null!==t&&(i.r=t.levels[0],i.g=t.levels[1],i.b=t.levels[2],i.a=t.levels[3]),null!==e&&(s.r=e.levels[0],s.g=e.levels[1],s.b=e.levels[2],s.a=e.levels[3]),color(random(i.r,s.r),random(i.g,s.g),random(i.b,s.b),random(i.a,s.a))}}class WebbedTextVertex{constructor(t,e,i,s,o,l,r,h=5,n=20){this.origin=t,this.position=e,this.movementRadius=i,this.direction=s,this.offset=o,this.alpha=0,this.numConnections=0,this.maxConnectableDistance=n,this.connections=[],this.radius=h,this.color=l,this.lineColor=r}run(t,e,i=null){this.draw(i),this.move(t),this.lineBetween(e,i)}move(t){this.position.x=this.origin.x+sin(t*this.direction+this.offset)*this.movementRadius,this.position.y=this.origin.y+cos(t*this.direction+this.offset)*this.movementRadius}lineBetween(t,e=null){this.numConnections=1;for(let i=0;i<t.length;i++){let s=t[i],o=this.position.dist(s.position);if(o>0&&o<this.maxConnectableDistance){this.alpha=map(this.numConnections,0,10,10,255);let t=this.lineColor.getColor();null!==e?(e.stroke(t.levels[0],t.levels[1],t.levels[2],this.alpha),e.line(this.position.x,this.position.y,s.position.x,s.position.y)):(stroke(t.levels[0],t.levels[1],t.levels[2],this.alpha),line(this.position.x,this.position.y,s.position.x,s.position.y)),this.connections[i]=!0}else this.connections[i]=!1}for(let e=0;e<t.length;e++)this.connections[e]&&this.numConnections++}draw(t=null){null!==t?(t.noStroke(),t.fill(this.color.getColor()),t.ellipse(this.position.x,this.position.y,this.radius,this.radius)):(noStroke(),fill(this.color.getColor()),ellipse(this.position.x,this.position.y,this.radius,this.radius))}}class WebbedText{constructor(t,e=0,i=0,s=2e3,o="Helvetica",l=100,r={}){this.text=t,this.x=e,this.y=i,this.numVertices=s,this.fontName=o,this.fontSize=l,this.theta=0,this.vertices=[],this.options={minVertexMovementRadius:5,maxVertexMovementRadius:10,vertexRadius:5,maxVertexConnectableDistance:20,vertexMovementSpeed:.05,vertexColor:new WebbedTextColor(WebbedTextColorType.FIXED,color(255,0,0,255)),lineColor:new WebbedTextColor(WebbedTextColorType.FIXED,color(255,255,255,255)),globalVertexColor:!1,globalLineColor:!1},Object.assign(this.options,r)}setup(){this.vertices=[];let t=createGraphics(width,height);t.textFont(this.fontName,this.fontSize);let e=Math.round(t.textWidth(this.text)),i=Math.round(t.textAscent()),s=Math.round(t.textDescent());t.resizeCanvas(e,i+s),t.push(),t.noStroke(),t.background(255),t.fill(0),t.textFont(this.fontName,this.fontSize),t.textAlign(LEFT,TOP),t.text(this.text,0,0,e,i+s),t.pop(),t.loadPixels();for(let e=0;e<this.numVertices;e++){let e=Math.floor(random(t.width)),i=Math.floor(random(t.height));if(brightness(t.get(e,i))<100){let t=createVector(e+this.x,i+this.y),s=random(this.options.minVertexMovementRadius,this.options.maxVertexMovementRadius),o=createVector(t.x+s,t.y),l=random(TWO_PI),r=1;random(1)>.5&&(r=-1);let h=this.options.vertexColor;!1===this.options.globalVertexColor&&(h=this.options.vertexColor.clone());let n=this.options.lineColor;!1===this.options.globalLineColor&&(n=this.options.lineColor.clone());let a=new WebbedTextVertex(t,o,s,r,l,h,n,this.options.vertexRadius,this.options.maxVertexConnectableDistance);this.vertices.push(a)}}t.noCanvas(),t=null}draw(t=null){for(let e=0;e<this.vertices.length;e++)this.vertices[e].run(this.theta,this.vertices,t);this.theta+=this.options.vertexMovementSpeed}}